name: LeetCode Auto Sync

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  sync_solutions:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: LeetCode Submissions Sync
        uses: joshcai/leetcode-sync@v1.5
        with:
          github-token: ${{ secrets.GH_TOKEN }}
          leetcode-session: ${{ secrets.LEETCODE_SESSION }}
          leetcode-csrf-token: ${{ secrets.LEETCODE_CSRF_TOKEN }}
          destination-folder: temp_solutions

      - name: Organize into separate folders
        run: |
          cd temp_solutions
          
          # Process each solution file
          for file in *; do
            if [ -f "$file" ]; then
              # Extract problem number and name
              filename="${file%.*}"
              extension="${file##*.}"
              
              # Create folder in root with problem name
              mkdir -p "../$filename"
              
              # Move file into its folder
              mv "$file" "../$filename/solution.$extension"
              
              # Optional: Create a README for each problem
              echo "# $filename" > "../$filename/README.md"
            fi
          done
          
          # Remove temp folder
          cd ..
          rm -rf temp_solutions

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git diff --quiet && git diff --staged --quiet || (git commit -m "Sync LeetCode solutions" && git push)
